# Инструкция по созданию новой 3D CAD модели

## Обзор

Данная библиотека позволяет создавать 3D CAD модели используя **Signed Distance Functions (SDF)**. Модели описываются программным кодом на языке Go и экспортируются в различные форматы для 3D печати или просмотра.

## Основные концепции

### SDF (Signed Distance Functions)
- **SDF2** - двумерные функции расстояния со знаком
- **SDF3** - трехмерные функции расстояния со знаком
- Значение функции: отрицательное = внутри объекта, положительное = снаружи, 0 = на границе

### Архитектура проекта
```
/home/engine/project/
├── sdf/          # Основная библиотека SDF
├── render/       # Рендеринг в файлы (STL, 3MF, SVG, PNG)
├── obj/          # Готовые объекты (шестерни, болты, оси)
├── examples/     # Примеры моделей
└── vec/          # Векторная математика
```

## Быстрый старт

### 1. Создание простейшей модели

Создайте новую папку в `/home/engine/project/examples/`:

```bash
mkdir examples/my_model
cd examples/my_model
```

### 2. Базовый код модели

Создайте файл `main.go`:

```go
package main

import (
    "log"
    "github.com/deadsy/sdfx/render"
    "github.com/deadsy/sdfx/sdf"
)

func main() {
    // Создаем куб 10x10x10 мм
    box, err := sdf.Box3D(sdf.V3{5, 5, 5}, 0)
    if err != nil {
        log.Fatal(err)
    }
    
    // Экспортируем в STL
    render.ToSTL(box, "my_box.stl", render.NewMarchingCubesOctree(300))
}
```

### 3. Сборка и запуск

```bash
cd examples/my_model
go mod init my_model
go mod edit -replace github.com/deadsy/sdfx=../..
go mod tidy
go run main.go
```

## Основные примитивы

### 2D примитивы
```go
// Круг
circle := sdf.Circle2D(5.0)

// Прямоугольник
rect := sdf.Box2D(sdf.V2{10, 20}, 2.0)

// Многоугольник
points := []sdf.V2{
    {0, 0}, {10, 0}, {10, 10}, {0, 10},
}
poly := sdf.Polygon2D(points)
```

### 3D примитивы
```go
// Кубоид
box := sdf.Box3D(sdf.V3{10, 20, 30}, 2.0)

// Сфера
sphere := sdf.Sphere3D(15.0)

// Цилиндр
cylinder := sdf.Cylinder3D(5.0, 20.0, 1.0)

// Конус
cone := sdf.Cone3D(10.0, 5.0, 20.0, 1.0)
```

## Булевы операции

### Объединение
```go
combined := sdf.Union3D(box, sphere)
```

### Вычитание
```go
hollow := sdf.Difference3D(box, sdf.Sphere3D(7.0))
```

### Пересечение
```go
intersection := sdf.Intersection3D(box, sdf.Cylinder3D(15.0, 30.0, 0))
```

### Множественные объекты
```go
multiple := sdf.Union3D(obj1, obj2, obj3, obj4)
```

## Трансформации

### Масштабирование
```go
// Равномерное масштабирование
scaled := sdf.ScaleUniform3D(obj, 2.0)

// Неравномерное масштабирование
scaled := sdf.Scale3D(obj, sdf.V3{1.0, 2.0, 0.5})
```

### Перемещение
```go
moved := sdf.Translate3D(obj, sdf.V3{10, 5, 0})
```

### Поворот
```go
// Поворот вокруг осей
rotated := sdf.RotateX3D(obj, sdf.DtoR(45))
rotated = sdf.RotateY3D(rotated, sdf.DtoR(30))
rotated = sdf.RotateZ3D(rotated, sdf.DtoR(15))
```

## Экструзия

### Линейная экструзия
```go
// 2D форма в 3D объект
extruded := sdf.Extrude3D(shape2D, height)
```

### Экструзия с закругленными краями
```go
rounded := sdf.ExtrudeRounded3D(shape2D, height, radius)
```

### Винтовая экструзия (резьба)
```go
thread := sdf.ExtrudeTwist3D(shape2D, height, sdf.DtoR(360))
```

## Работа с кривыми Безье

### Создание 2D кривой
```go
b := sdf.NewBezier()
b.Add(0, 0)
b.Add(10, 0).HandleFwd(sdf.DtoR(45), 5)
b.Add(20, 10).Handle(sdf.DtoR(90), 3, 3)
b.Add(10, 20).Handle(sdf.DtoR(180), 4, 4)
b.Add(0, 20).HandleRev(sdf.DtoR(270), 2)
b.Close()

// Преобразование в сетку для рендеринга
mesh2d, err := b.Mesh2D()
```

### Создание поверхности вращения
```go
// Вращение 2D кривой вокруг оси
revolved := sdf.Revolve3D(mesh2d)
```

## Готовые объекты

### Шестерни
```go
gearParams := obj.GearParms{
    Module:      1.0,
    Teeth:       20,
    Pressure:    sdf.DtoR(20),
    Thickness:   10.0,
}
gear, err := obj.InvoluteGear3D(&gearParams)
```

### Болты и гайки
```go
boltParams := obj.BoltParms{
    Thread:    5.0,    // диаметр резьбы
    Length:    50.0,   // длина
    Shank:     6.0,    // диаметр стержня
    HeadDia:   8.0,    // диаметр головки
    HeadThick: 3.0,    // толщина головки
}
bolt, err := obj.Bolt3D(&boltParams)
```

### Оси
```go
shaftParams := obj.ShaftParms{
    Length: 100.0,
    Dia:    10.0,
    Keyway: obj.KeywayParms{3.0, 3.0},
}
shaft, err := obj.Shaft3D(&shaftParams)
```

## Скругления и фаски

### Скругление ребер
```go
rounded := sdf.Fillet3D(obj, radius)
```

### Фаски
```go
chamfered := sdf.Chamfer3D(obj, radius)
```

## Размеры и единицы измерения

### Доступные константы
```go
sdf.MillimetresPerInch  // 25.4
sdf.InchesPerMM         // 0.0393701

// Примеры использования
length := 2.5 * sdf.MillimetresPerInch  // 2.5 дюйма в мм
```

### Компенсация усадки материала
```go
const shrink = 1.0 / 0.999  // PLA ~0.1%
// const shrink = 1.0/0.995  // ABS ~0.5%

model := sdf.ScaleUniform3D(originalModel, shrink)
```

## Экспорт моделей

### STL (для 3D печати)
```go
render.ToSTL(model, "output.stl", render.NewMarchingCubesOctree(300))
```

### 3MF (современный формат)
```go
render.To3MF(model, "output.3mf", render.NewMarchingCubesOctree(300))
```

### SVG (для лазерной резки)
```go
render.ToSVG(model2d, "output.svg")
```

### PNG (предварительный просмотр)
```go
render.ToPNG(model, "preview.png", 800, 600)
```

## Продвинутые техники

### Параметрические модели
```go
type WidgetParams struct {
    Width     float64
    Height    float64
    Depth     float64
    HoleDia   float64
    WallThick float64
}

func CreateWidget(params WidgetParams) (sdf.SDF3, error) {
    // Внешние размеры
    outer := sdf.Box3D(
        sdf.V3{params.Width/2, params.Height/2, params.Depth/2}, 
        0,
    )
    
    // Внутренняя полость
    innerSize := sdf.V3{
        params.Width - 2*params.WallThick,
        params.Height - 2*params.WallThick,
        params.Depth - params.WallThick, // дно тоньше
    }
    inner := sdf.Box3D(innerSize, 0)
    
    // Отверстие
    hole := sdf.Cylinder3D(params.HoleDia/2, params.Depth, 0)
    hole = sdf.RotateX3D(hole, sdf.DtoR(90))
    
    // Объединяем все операции
    result := sdf.Difference3D(outer, inner)
    result = sdf.Difference3D(result, hole)
    
    return result, nil
}
```

### Текст и символы
```go
text, err := sdf.Text3D("Hello World", fontData, 10.0, 2.0)
```

### Пружины
```go
coil := sdf.Helix3D(10.0, 50.0, 5.0, 1.0)
```

## Оптимизация производительности

### Качество vs скорость
```go
// Быстрый рендеринг (черновой)
render.ToSTL(model, "preview.stl", render.NewMarchingCubesOctree(150))

// Высокое качество (финальный)
render.ToSTL(model, "final.stl", render.NewMarchingCubesOctree(500))
```

### Кеширование
```go
cached := sdf.Cache3D(expensiveObject, cacheSize)
```

## Отладка и просмотр

### Внешние инструменты
- [MeshLab](http://www.meshlab.net/) - просмотр STL/3MF
- [SDF Viewer Go](https://github.com/Yeicor/sdf-viewer-go) - интерактивный просмотр SDF
- [SDFX-UI](https://github.com/Yeicor/sdfx-ui) - визуальная среда разработки

### Создание тестов
```go
// Проверка размеров
if math.Abs(bolt.BoundingBox().Max.X - expectedLength) > 0.01 {
    return nil, fmt.Errorf("неверная длина болта")
}
```

## Полезные ресурсы

### Примеры для изучения
- `examples/angle/` - простые уголки
- `examples/bezier/` - кривые Безье
- `examples/gear/` - шестерни и механизмы
- `examples/text/` - текстовые объекты
- `examples/screw/` - резьбы и крепеж

### Документация
- [GoDoc](https://godoc.org/github.com/deadsy/sdfx/sdf)
- Исходный код в `/home/engine/project/sdf/`
- Галерея готовых моделей в `/home/engine/project/docs/gallery/`

## Типичные задачи

### Создание корпуса с отверстиями
```go
// Внешний корпус
body := sdf.Box3D(sdf.V3{50, 30, 20}, 2.0)

// Вентиляционные отверстия
hole1 := sdf.Cylinder3D(2.5, 25, 0)
hole2 := sdf.Cylinder3D(2.5, 25, 0)

// Расположение отверстий
hole1 = sdf.Translate3D(hole1, sdf.V3{-15, 0, 0})
hole2 = sdf.Translate3D(hole2, sdf.V3{15, 0, 0})

// Вырезаем отверстия
result := sdf.Difference3D(body, hole1, hole2)
```

### Создание шестерни с валом
```go
// Параметры шестерни
gearP := obj.GearParms{
    Module:   1.5,
    Teeth:    30,
    Thickness: 8.0,
}
gear, _ := obj.InvoluteGear3D(&gearP)

// Параметры вала
shaftP := obj.ShaftParms{
    Length: 60.0,
    Dia:    8.0,
}
shaft, _ := obj.Shaft3D(&shaftP)

// Центрируем и объединяем
shaft = sdf.Translate3D(shaft, sdf.V3{0, 0, -10})
complete := sdf.Union3D(gear, shaft)
```

Эта инструкция покрывает основы создания 3D моделей с использованием SDFx. Изучите примеры в папке `/home/engine/project/examples/` для более сложных техник и идей.